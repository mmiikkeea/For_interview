package com.amazonaws.starport.vulnerabilityscanner.scanner;

import java.util.ArrayList;
import java.util.List;

import org.junit.Assert;
import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.mockito.Mockito;
import org.mockito.runners.MockitoJUnitRunner;

import com.amazonaws.starport.vulnerabilityscanner.model.ApplicationModel;
import com.amazonaws.starport.vulnerabilityscanner.testdata.LayerAppData;

@RunWith(MockitoJUnitRunner.class)
public class LayerRepositoryTest {

    private LayerRepository layerRepository;
    private LayerAppData layerAppData;

    @Before
    public void setUp() throws Exception {
        layerAppData = Mockito.mock(LayerAppData.class);
        layerRepository = new LayerRepository(layerAppData);
    }

    @Test
    public void getAppForLayerTest() {
        final String inputLayer = "sha:aaa";
        final List<ApplicationModel> value = setAppList();
        Mockito.when(layerAppData.getData(inputLayer)).thenReturn(value);
        final List<ApplicationModel> appForLayer = layerRepository
                .getAppForLayer(inputLayer);
        Assert.assertThat(appForLayer, org.hamcrest.Matchers.hasSize(3));
    }

    private List<ApplicationModel> setAppList() {
        final List<ApplicationModel> value = new ArrayList<>();
        final ApplicationModel app1 = new ApplicationModel("bash", "4.0");
        value.add(app1);
        value.add(app1);
        value.add(app1);
        return value;
    }
}
