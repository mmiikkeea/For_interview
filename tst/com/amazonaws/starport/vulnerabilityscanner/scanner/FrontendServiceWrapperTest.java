package com.amazonaws.starport.vulnerabilityscanner.scanner;

import java.io.IOException;
import java.util.concurrent.ExecutionException;

import lombok.NonNull;

import org.junit.Assert;
import org.junit.Before;
import org.junit.Test;

import balsa.internal.codehaus.jackson.JsonParseException;

public class FrontendServiceWrapperTest {
    @NonNull
    private FrontendServiceWrapper frontendServiceDouble;

    @Before
    public void setUp() throws Exception {
        frontendServiceDouble = new FrontendServiceWrapper();
    }

    @Test
    public void getLayerByImageTest() throws JsonParseException, IOException {
        Assert.assertEquals(3,
                frontendServiceDouble.getLayerByImage("123", null).size());
    }

    @Test
    public void getLayerByImageThroughJavaClient() throws InterruptedException,
            ExecutionException, JsonParseException, IOException {
        System.setProperty("CORAL_CONFIG_PATH",
                "/StarportVulnerabilityScanner/build/StarportFrontendServiceClientConfig");

        final String imageDigest = "sha256:65ed13860ad4edf8b762a9644c2d51104e3e6f5b9261cd078d949d9e7016232a";
        final String repositoryName = "test0629";
        Assert.assertEquals(0, frontendServiceDouble.getLayerByImage(
                imageDigest, repositoryName));
    }
}
