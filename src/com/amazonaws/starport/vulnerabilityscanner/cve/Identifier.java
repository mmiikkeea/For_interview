package com.amazonaws.starport.vulnerabilityscanner.cve;

import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

import javax.xml.parsers.ParserConfigurationException;
import javax.xml.stream.XMLStreamException;

import lombok.NonNull;
import lombok.extern.java.Log;

import org.xml.sax.SAXException;

import com.amazonaws.starport.vulnerabilityscanner.model.ApplicationModel;
import com.amazonaws.starport.vulnerabilityscanner.model.CveModel;

@Log
public class Identifier {
    @NonNull
    private final Parser cveParser;

    public Identifier(final Parser cveParser2) {
        cveParser = cveParser2;
    }

    public List<CveModel> getCve(final ApplicationModel imageApp,
            final String imageOS)

    throws IOException, XMLStreamException, SAXException,
            ParserConfigurationException {

        final List<CveModel> cveData = cveParser
                .parsedCve("CVEfolder/nvdcve-2.0-2016.xml");

        final long startTime = System.currentTimeMillis();
        final List<CveModel> report = new ArrayList<>();
        // for each cve id
        for (final CveModel parsedxml : cveData) {
            if (parsedxml.affects(imageApp, imageOS)) {
                report.add(parsedxml);
            }
        }
        final long entTime = System.currentTimeMillis();
        final long totalTime = entTime - startTime;
        log.info("search took: " + totalTime);
        return report;
    }
}