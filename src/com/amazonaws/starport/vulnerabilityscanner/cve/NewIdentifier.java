package com.amazonaws.starport.vulnerabilityscanner.cve;

import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

import javax.xml.parsers.ParserConfigurationException;

import lombok.NonNull;
import lombok.extern.java.Log;

import org.xml.sax.SAXException;

import com.amazonaws.starport.vulnerabilityscanner.model.ApplicationModel;
import com.amazonaws.starport.vulnerabilityscanner.model.NewXmlModel;

@Log
public class NewIdentifier {
    @NonNull
    private List<NewXmlModel> cveData;
    private final ParsedInTree nvdParser;

    public NewIdentifier(final ParsedInTree cveParser) {
        nvdParser = cveParser;
    }

    public List<NewXmlModel> getCve(final List<ApplicationModel> imageApp)
            throws SAXException, IOException, ParserConfigurationException {
        cveData = nvdParser.parsedCve("CVEfolder/nvdTest.xml");
        final long startTime = System.currentTimeMillis();
        final List<NewXmlModel> cveReport = new ArrayList<>();
        // for each cve id
        for (final NewXmlModel parsedxml : cveData) {
            if (parsedxml.affects(imageApp)) {
                cveReport.add(parsedxml);
            }
        }
        final long entTime = System.currentTimeMillis();
        final long totalTime = entTime - startTime;
        log.warning("search took: " + totalTime);
        return cveReport;
    }
}